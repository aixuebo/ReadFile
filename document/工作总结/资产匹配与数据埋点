一、两个队列--资产队列和资金队列
1.资产队列表示资产,每一个房产就是一个资产,比如房产需要100万,那么这就是一个订单,资产队列就存储要匹配的资产订单集合
2.资金队列,就是用户投资一笔产生的订单,即一个用户投资10次,则产生10个订单,则在资金队列中有10个元素数据

二、现阶段问题:
1.资产少,资金多,因此会有资金闲置,没产生收益。
2.用户由于资金没有全部匹配,因此不可能把用户投资的钱都按照统一利息给,这样也不合规,也给公司带来额外的损失。
因此用户资金分成已经匹配成功的，未匹配成功的,这样就两种利息赋给用户即可。

由于国家的合规性,因此不与许补贴利息,因此未匹配的就应该利息很少。

三、最终要解决的问题是,如何匹配资金,让合规又对用户满意。

四、解决方案
以下方法都是对资金端处理,资产端暂时一个一个处理即可,处理完一个资产,换下一个资产。

方法1
1.简单暴力的方法,从资金队列中一个一个订单去匹配,采用先进先出的方式。
这种方式优点就是简单,但是缺点是VIP用户的钱多,会处理很久,让其他用户很久都无法匹配上资产,用户会有流失。

方法2
1.按照优先级,分成若干个队列,比如分成4个队列。
a.可以以此从最高优先级队列找资金,然后队列没有了，在去第二个队列找资金。。。以此类推
b.给每一个队列不同权重,因此同时去每一个队列获取资金。只是优先级队列低的,消耗资金的慢而已。
a是有缺点的,可能导致最后一个队列一直都不会被消费掉。但是可以通过动态调节订单的优先级,将订单1在各个队列中来回移动切换

问题来了,如何把订单放到不同的对列中呢。
1.每一个订单都分成5分.即轮训匹配每一个订单，每一个订单的第一份都先处理掉,然后处理第二份订单。。以此类推,每一分订单的优先级不同.因此加入不同的队列中
2.根据用户订单的时间,做为权重,时间久的没处理完的,要提高优先级,让其加入高优先级队列中
3.根据用户的现存量调控优先级,如果用户存量较多,经过调查,发现60%的存量被匹配了,则用户满意度就会很好的满意了,因此用户存量超过60%的,调低优先级,即该用户所有的订单都要调低优先级,而不是单单一个订单。
4.定期用户的优先级上调,因为定期用户的优先级对我们有利.

五、测试
如何对历史的数据进行测试
1.建立测试环境
将历史某一个周期的资产按照时间顺序排序,单独拿出来做数据库,作为资产数据库
将历史某一个周期的用户投资订单按照时间顺序排序,单独拿出来做数据库,作为资金数据库
2.根据把订单分成5分还是6分等等，用户订单处理时间周期权重，用户存量的占比是满意度进行调节,最终看效果

主要效果
1.多久能把用户订单的资金全匹配完成，越短越好。



------------------------------------------------------------------------
数据埋点
一、流程
有一个web服务,接受日志--日记收集到一台机器---上传到hive中---ETL处理---数据分析---输出mysql

二、数据web服务架构
1.鉴权---先查看上传的客户端是否是我们的客户端,用一个静态的key进行校验即可,如果鉴权成功,返回给客户端一个token
2.鉴权成功的客户端可以发送数据给服务器---每次上传数据都带token--服务器收集数据，解析token，token可能带有时间戳，判断上传的数据时间是否有效，因为数据可能是第二天传过来的，我们要失效处理。
a.日志分别解析成html端来的日志、app来的日志，分别存储到两个数据源中
b.异常日志和测试数据存储到kafka里面,异常日志用于让别人看到错误信息,及时修改代码以及定期发送错误日志日报给管理者和相关联系人。测试数据存放到kafka中,让测试人员可以随时看到测试的信息,判断测试是否正确。





