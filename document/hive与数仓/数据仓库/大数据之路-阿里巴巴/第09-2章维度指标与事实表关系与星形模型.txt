一、背景与总结
1.原子指标/度量:业务过程中不可拆分的行为度量指标。由业务动作+度量组成，比如完成订单量。
2.派生指标:原子指标+多个修饰词+时间范围+维度组成。 例如最近1天(时间范围)+海外(修饰词)+买家(维度)+完成订单量(原子指标)
3.限定条件：在物理实现上我们将其加工成衍生事实的一个逻辑标签, 尝尝字段标签为is_xxx，即是否xxx
4.数据总线矩阵:
明确业务过程所属的数据域。
明确业务过程与维度的关系。
明确业务过程中涉及到的原子指标、派生指标。

倒推法:
需求侧,给出指标和维度；基于指标和维度,明确业务过程；对业务过程归属到数据域。

二、事实表:必然存在的一些数据，像采集的日志文件，订单表，都可以作为事实表。

1.例子
银行对存款记账，A表中存放实际数据，包括账号、所属机构号、存款金额等，B表存放机构号和机构名称的对应关系。则A是事实表，B是维表。

2.事实表
事实表，即为事实数据表的简称。主要特点是含有大量的数据，并且这些数据是可以汇总，并被记录的。
1.大量的明细数据。
2.指标数据是可以参与汇总的。即他就是存储的明细数据的fact层。一定不是aggr层，因为aggr已经发生了聚合。但简单的aggr聚合数据也算明细数据，也算事实表。

3.例子
1.流水明细: 商品编号、商品名称、价格、售卖数量、供应商。
2.如果1是事实表，虽然他是明细数据，但粗在那问题，比如供应商/商品名改了，就需要全部流水数据都要改。
因此需要抽象出维度表,真实的事实表只持有维度id以及具体的事实明细交易流水信息。

4.模型
星形模式：以事实表为中心，所有的维度表直接连在事实表上，最简单最常用的一种 = 1个事实表+N个维度表。
	星形模型打平，就是大宽表。
雪花模式：比星形模式复杂在维度表可以继续星形模式扩展，即雪花模式的维度表可以拥有其他的维度表，这种表不易维护，一般不推荐使用 = 1个事实表+N个维度表。
星座模型：基于多张事实表，而且共享维度信息，即事实表之间可以共享某些维度表。
	事实表+维度表+事实表
	扩展一下，感觉只要是事实表+事实表的，都可以划分到星族上。
	比如 poi表是一个维度表，有poiid与poi的属性，比如有组织结构
	订单事实表+ poi维度表 + 组织结构事实表。组成了星座。

三、事实表种类:
1~5都来自于同一个业务过程的fact表基础上操作，6是属于topic层，来自多个业务过程合并。
1~3事实表描述的是 维度+指标度量才叫事实表。即fact粒度的事实表，属于明细层事实表。
4也是fact粒度的事实表。只是存储的内容不是指标度量
5是aggr层聚合后的事实表。属于汇总层事实表。也是针对单一fact表进行汇总。
6是属于topic层，来自多个业务过程合并。


1.事务事实表
每一行数据，表示某一个时间点的内容，比如订单表，表示该订单在某一个时间点的金额。
即由该时间点的 度量指标 + 维度表主键组成。
度量的指标值与事物表的粒度保持一致。比如订单表，所有度量的指标都是订单粒度的。

2.周期快照事实表
每一行数据都带有周期字段，比如dt。
粒度是统计周期内的度量指标+维度表主键组成。
统计粒度是周期，而不是个体的事务数据，也就是说一个周期快照事实表中数据可以是多个事实内容，但是它们都属于某个周期内。比如一周内的订单量，他是单个订单事物的求和。

3.累计快照事实表
周期快照事实表是单个周期内数据，而累计快照事实表是由多个周期数据组成，每行汇总了过程开始到结束之间的度量。
比如商家周交易累计表，会统计截止本周内商家总订单量，因此当有新订单的时候，就会修改该周期内订单量字段的内容。
如果是订单数据事实表，累计快照事实表的一行就是一个订单，当订单产生时插入一行，当订单发生变化时，这行就被修改。

4.无事实的事实表
我们以上讨论的事实表度量都是数字化的，但是也可能会有少量的没有数字化的值但是还很有价值的字段，利用这种事实表可以分析发生了什么。

5.聚集事实表
聚集，就是对原子粒度的数据进行简单的聚合操作，目的就是为了提高查询性能。
是aggr层聚合后的事实表。属于汇总层事实表。也是针对单一fact表进行汇总。

6.合并事实表
这种事实表遵循一个原则，就是相同粒度，数据可以来自多个过程，但是只要它们属于相同粒度，就可以合并为一个事实表，这类事实表特别适合经常需要共同分析的多过程度量。


四、维度表
1.维度表要有单一的主键列。
2.维度表通常比较宽，包含大量的低粒度的文本属性。
3.根据维度可以对数据进行跨事实表聚合，通过维度进行关联查询(即跨表查询)，同时支持上钻、下钻
上钻（roll-up）：上卷是沿着维的层次向上聚集汇总数据。例如，对产品销售数据，沿着时间维上卷，可以求出所有产品在所有地区每月（或季度或年或全部）的销售额。
下钻（drill-down）：它是沿着维的层次向下，查看更详细的数据。
4.退化维度
退化维度就是将维度退回到事实表中。减少关联次数，提高查询性能。
缺点是维度变化时，引起回刷问题。
5.多层次维度
比如 日周月，放到一个维度表，还是雪花模型扩展。 再比如省份城市信息。