
一、背景、概念、总结
参见 qq邮箱--工作 -- 数据仓库指标命名标准
1.维度建模总线架构
2.维度表与事实表
3.业务板块、数据域、业务过程/业务动作、修饰类型与修饰词、维度、原子指标、派生指标。
4.限定条件：在物理实现上我们将其加工成衍生事实的一个逻辑标签, 尝尝字段标签为is_xxx，即是否xxx
5.总线矩阵: 即 明确 数据域--业务过程--维度之间的关系。 
具体参见“实战-构建数据总线矩阵过程.txt”
明确业务过程所属的数据域。
明确业务过程与维度的关系。
明确业务过程中涉及到的原子指标、派生指标。

倒推法:
需求侧,给出指标和维度；基于指标和维度,明确业务过程；对业务过程归属到数据域。

二、体系架构
总结:
业务域要做到独立。是数仓的根目录。
业务域下由若干个数据域组成，相当于若干个topic组成。
数据域依赖维度建模，而基础维度+原子指标来自于fact的业务过程。
基于fact，丰富维度信息。扩展维度表。
基于维度信息+修饰词+原子指标，扩展派生指标。创建aggr层。


1.业务板块/业务域:由于阿里巴巴集团业务生态庞大，所以根据业务的属性 划分出几个相对独立的业务板块，业务板块之间的指标或业务重叠性较小。
因此每一个业务板块独立数仓。比如淘宝、支付宝分别有独立的数仓。
比如电商业务。

2.规范定义
规范定义指以维度建模作为理论基础 ， 构建总线矩阵，划分和定义 数据域、业务过程、维度、度量 / 原子指标、修饰类型、修饰词、时间 周期、派生指标。

第一部分:--定义fact和topic层概念
数据域:相当于topic表，面向业务分析,将多个业务过程+维度进行整合。
	比如交易域。
业务过程:相当于fact表，具体的业务活动，比如下单、支付、退款。业务过程是不可拆分的行为事件，即企业活动中的真实事件；
		业务过程可以拆分原子指标、基础维度。
		比如 下单、退款。

第二部分:---定义aggr、dim概念
维度表:是一列属性的集合，也称之为实体对象。相当于java开发的vo对象。 比如商家维度。
维度属性:隶属于某一个维度。
原子指标/度量:业务过程中不可拆分的行为度量指标。由业务动作+度量组成，比如完成订单量。
派生指标:原子指标+多个修饰词+时间范围+维度组成。 例如最近1天(时间范围)+海外(修饰词)+买家(维度)+完成订单量(原子指标)

第三部分:---全局业务域共享的公共维度信息
修饰类型:是对修饰词的一种抽象划分，隶属于某一个业务域。
     比如 支付方式。他不属于任意维度。
修饰词:维度外的业务场景的限定抽象，隶属于一种修饰类型。比如日志域的访问类型，有修饰词PC端、无线端等。
     比如 支付方式中的花呗、网银。

三、指标体系
1.基础原则
原子指标：来自于业务过程。必须挂靠在某一个业务过程内。
原子指标有确定的英文字段名、数据类型和算法说明:派生指标 要继承原子指标的英文名、数据类型和算法要求。
一般 而言，事务型指标和存量型指标(见下文定义)只会唯 一 定位 到一个业务过程

2.命名约定
先定义业务过程。
关于存量型原子指标对应 的业务过程的约定命名:
	实体对象 英文名 +_stock。如在线会员数、 一星会员数等 ，其对应的业务过程为 mbr_stock1；
	在线商品数、商品 SKU 种类小于 5 的商品数，其对应的业务过程为 itm_stock

3.派生指标分类
事务类型指标:衡量业务活动的指标，比如新发商品数、新增注册会员数、支付订单金额。即原子指标+修饰词(当日新增)。
存量类型指标:对实体对象(商家、商品、会员)某些状态的统计。 比如商品总数、注册会员总数，原子指标+周期,一般为截止当前某一个时间点的指标度量值。
复合类型指标:我可以理解成他是计算指标。比如 浏览uv-下单买家数转化率。


四、模型设计
数据模型的维度设计主要 以 维度建模理论为基础，基于维度数据模型总线架构，构建 一致 性的维度 和事实。
1.模型分层
ODS:O表，原封不动的保存数据源
CDM:公共维度模型层，包含DWD明细数据侧、DWS汇总数据层。
	明细表划分:事务类型事实表(无快照)、快照类型事实表、累计快照类型事实表。
ADS:应用数据层。
	个性化指标加工:不公用性、复杂性(指数型、比值型、排名型指标)

2.模型建设原则
高内聚低耦合。
核心模型与扩展模型分离。扩展模型支持少了个性化需求。
公共处理逻辑(if case等派生指标)要下沉到aggr，不要暴露给应用层；并且单一，不要多处同时存在。
数据冗余换取的查询性能与回刷成本要平衡，不要过度冗余。
数据可回滚。不同时间多次运行，数据结果不变。

3.实施过程
a.充分调研业务的需求与分析。
b.数据总体架构设计,主要根据数据域对数据进行划分。
c.按照维度建模理论，构建总线矩阵，抽象业务过程和维度。
d.根据需求,创建指标所属分类，以及对派生指标定义好修饰词+维度+原子指标。
e.构建数据总线矩阵。

4.构建数据总线矩阵过程
具体参见“实战-构建数据总线矩阵过程.txt”

