
## 一、背景与总结
1.工具
计算两个地方的距离：百度地图。
2.计算每一个地图点的经纬度:百度地图 -- 地图开放平台 -- 坐标拾取器
3.经纬度转换成geohash  https://csxgame.top/#/


## 二、geohash之间的距离误差
## 1.Geohash的长度与其对应的地理位置精度有直接关系。以下是一些常见Geohash长度及其大致对应的精度：
注意：一般使用经度误差用来参考实际情况。
1位：经度误差 ±2500公里，纬度误差 ±1250公里
2位：经度误差 ±630公里，纬度误差 ±390公里
3位：经度误差 ±78公里，纬度误差 ±39公里
4位：经度误差 ±20公里，纬度误差 ±10公里
5位：经度误差 ±2.4公里，纬度误差 ±1.2公里
6位：经度误差 ±0.61公里，纬度误差 ±0.38公里
7位：经度误差 ±0.076公里，纬度误差 ±0.038公里
8位：经度误差 ±0.019公里，纬度误差 ±0.0095公里
9位：经度误差 ±0.0024公里，纬度误差 ±0.0012公里
以上数值是大致的精度误差，实际误差可能因地理位置（尤其是纬度）的不同而略有差异。

## 2.4位误差 ±20公里怎么理解
a.一个Geohash代表了地球表面上的一个矩形区域，该区域的大小取决于Geohash编码的长度。
b.数越长，画的矩形区域越小，所以误差越精准。
c.表示相同的4位的geohash,意味着对应的地理位置可能在实际位置的20公里范围内。

## 3.误差是非常固定的值么?
这是一个理论上的大致数值，实际应用中，由于地球并非完美的球体，而是接近椭球形状，因此在不同的纬度，相同长度的Geohash编码可能对应的实际地理范围会有所不同，误差也会有所差异。
总的来说，Geohash编码的误差并非完全固定，会受到地理位置（尤其是纬度）的影响。但在大部分应用场景中，这种影响可以忽略不计，因此我们通常会认为相同长度的Geohash编码对应的误差是相同的。


## 三、案例
1.来广营地铁:116.477728,40.027536    wx4gdwb3
2.中日友好:116.43262,39.980346    wx4g3qpw
3.两者距离8.8公里，直线距离6.1公开。4位geohash相同，在20公里范围内误差。

## 四、性能解析案例
1.输入
一组中心点的List<geohash>、几百万个poi组成的List<geohash>。
2.输出
每一个poi最近4公里范围内的中心点。
3.挑战
每一个中心点与几百万poi一一比较，是笛卡尔，运算体量太大了。
但5位是2.4公里，4位是20公里，跨度很大；
同时20公里内最大的geohash内poi数量可能是几十万。也是计算量很大。
4.实现
想法是能否用5位，但可以覆盖2.4公里-20公里之内的商家覆盖。
想到的是为每一个中心点扩大，比如扩大8个方向，则变成4.8公里，在扩大一轮，就是7.2公里。 
即一个中心点 扩展成 一个Set<中心点>集合，理论上变成8*8=64个，但可能存在geohash值重复的情况，所以会比这少。
最终相当于每一个中心点 变成 64个点，与64个点相关的poiList去做一一计算即可。
